<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="{{ path('app_home') }}">
    <img src="{{ asset('assets/images/logo.svg') }}" alt="Logo" height="32" class="d-inline-block align-text-top">
  </a>
  
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" 
          aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="{{ path('app_pages_how_it_works') }}">Comment ça marche ?</a>
      </li>
      <li class="nav-item">
        <a class="nav-link fw-bold" href="#">Trouver un trajet !</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{path('app_contact')}}">Contact</a>
      </li>
    </ul>

    <ul class="navbar-nav ms-auto">
  <li class="nav-item">
    <a id="inbox" class="nav-link d-flex align-items-center" href="{{ path('app_contact_message_index') }}">
      <i class="bi bi-envelope {{ unreadCount > 0 ? 'text-danger' : '' }}"></i>
      {% if unreadCount > 0 %}
        <span class="badge bg-danger ms-1">{{ unreadCount }}</span>
      {% endif %}
    </a>
  </li>

  {# Dans ta navbar #}
<li class="nav-item dropdown">
  {% if app.user %}
    {# --- Petits helpers pour l’affichage --- #}
    {% set pseudo   = app.user.pseudo ?? (app.user.email|split('@')[0]) %}
    {% set initial  = pseudo|slice(0,1)|upper %}
    {% set isDriver = 'ROLE_DRIVER' in app.user.roles %}
    {% set modeLabel = isDriver ? 'Conducteur' : 'Passager' %}
    {% set modeBadge = isDriver ? 'success' : 'primary' %}
    {% set targetMode = isDriver ? 'passenger' : 'driver' %}
    {% set switchLabel = isDriver ? 'Passer en mode Passager' : 'Passer en mode Conducteur' %}
    {% set switchIcon  = isDriver ? 'bi-person' : 'bi-car-front' %}

    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarAccount"
       data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span class="rounded-circle d-inline-flex align-items-center justify-content-center me-2"
            style="width:28px;height:28px;background:rgba(0,0,0,.08);">
        <strong class="small">{{ initial }}</strong>
      </span>
      <span class="d-none d-lg-inline">{{ pseudo }}</span>
    </a>

    <div class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="navbarAccount" style="min-width: 260px;">
      <div class="px-3 py-2 small">
        <div class="fw-semibold">{{ pseudo }}</div>
        <div class="text-muted">Mode actuel :
          <span class="badge bg-{{ modeBadge }}">{{ modeLabel }}</span>
        </div>
      </div>
      <div class="dropdown-divider"></div>

      {# Profil (exemple) #}
      <a class="dropdown-item" href="{{path('app_profile')}}">
        <i class="bi bi-person me-2"></i> Mon profil
      </a>

      {# L’action claire pour changer de mode #}
      <form method="post" action="{{ path('app_switch_mode') }}">
      <input type="hidden" name="_token" value="{{ csrf_token('switch_mode') }}">
      <button type="submit" class="dropdown-item d-flex align-items-center">
        <i class="bi {{ switchIcon }} me-2"></i> {{ switchLabel }}
      </button>
       </form>

      <div class="dropdown-divider"></div>

      {# Déconnexion #}
      <a class="dropdown-item text-danger" href="{{ path('app_logout') }}">
        <i class="bi bi-box-arrow-right me-2"></i> Déconnexion
      </a>
    </div>

  {% else %}
    <a class="nav-link dropdown-toggle" href="#" id="navbarAccount" data-bs-toggle="dropdown"
       aria-haspopup="true" aria-expanded="false">
      Mon compte
    </a>
    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarAccount">
      <a class="dropdown-item" href="{{ path('app_login') }}">
        <i class="bi bi-box-arrow-in-right me-2"></i> Connexion
      </a>
      <a class="dropdown-item" href="{{ path('app_register') }}">
        <i class="bi bi-person-plus me-2"></i> Créer mon compte
      </a>
    </div>
  {% endif %}
</li>

</ul>
  </div>
</nav>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const inbox = document.getElementById('inbox');
    const originalHTML = inbox.innerHTML;
    inbox.addEventListener('mouseenter', () => {
      inbox.innerHTML = 'Boîte de réception';
    });

    inbox.addEventListener('mouseleave', () => {
      inbox.innerHTML = originalHTML; 
    });
  });
</script>


