{% extends 'base.html.twig' %}

{% block title %}Détail du covoiturage #{{ couvoiturage.id }}{% endblock %}

{% block body %}
{# Bandeau titre #}
<section class="py-5 bg-light">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h4 text-primary mb-1">Covoiturage <span id="departAt">{{ couvoiturage.lieuDepart }}</span> <i class="bi bi-arrow-right"></i> {{ couvoiturage.lieuarrivee }}</h1>
        <p class="text-muted mb-0">Détails du trajet et actions disponibles.</p>
      </div>
    </div>
    <hr class="mt-4">
    <div class="row g-3 bg-light pt-2">
            <div class="col-md-4">
            
              <div class="text-muted small">Statut</div>
              {% set s = couvoiturage.statut %}
              {% set badgeClass =
                s == 'PUBLISHED' ? 'bg-success' :
                (s == 'FULL' ? 'bg-warning text-dark' :
                (s == 'CANCELLED' ? 'bg-danger' :
                (s == 'PLANNED' ? 'bg-secondary' : 'bg-info'))) %}
              <span class="badge {{ badgeClass }} fw-semibold">{{ s }}</span>
            </div>

            <div class="col-md-4">
              <div class="text-muted small">Places</div>
              <div class="fw-semibold">{{ couvoiturage.nbPlace }}</div>
            </div>

            <div class="col-md-4">
              <div class="text-muted small">Prix par personne (€)</div>
              <div class="fw-semibold">{{ couvoiturage.prixPersonne }}</div>
            </div>
            </div>
  </div>
</section>

<div class="container my-4">
  <div class="row g-4">

    {# ===== Colonne gauche : détails du trajet ===== #}
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        
                




        <div class="card-body">
          <div class="row g-3">
         
  <div class="card-body d-flex align-items-center">
    <div class="d-inline-flex align-items-center justify-content-center"
         style="width:52px;height:52px;border-radius:50%;background:rgba(13,110,253,.12);">
      <i class="bi bi-car-front-fill fs-4 text-primary"></i>
    </div>

    <div class="ms-3">
      <div class="fw-semibold">
        Trajet assuré par
        {% if couvoiturage.driver is defined and couvoiturage.driver %}
          <span class="text-primary">{{ couvoiturage.driver.prenom }} {{ couvoiturage.driver.nom }}</span>
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}
      </div>

      <div class="small text-muted mt-1">
        Véhicule :
        <span class="badge bg-light text-dark border">
          {{ couvoiturage.voiture.marque.nom }} {{ couvoiturage.voiture.modele }}
        </span>
      </div>
    </div>
  </div>



            <div class="col-md-6">
              <div class="text-muted small">Date de départ</div>
              <div class="fw-semibold">
                {{ couvoiturage.departAt ? couvoiturage.departAt|date('d/m/Y H:i') : '—' }}
              </div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Date d’arrivée</div>
              <div class="fw-semibold">
                {{ couvoiturage.arriveeAt ? couvoiturage.arriveeAt|date('d/m/Y H:i') : '—' }}
              </div>
            </div>

            <div class="col-md-6">
              <div class="text-muted small">Lieu de départ</div>
              <div class="fw-semibold">{{ couvoiturage.lieuDepart }}</div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Lieu d’arrivée</div>
              <div class="fw-semibold">{{ couvoiturage.lieuArrivee }}</div>
            </div>

          

            <div class="col-md-6">
              <div class="text-muted small">Créé le</div>
              <div class="fw-semibold">
                {{ couvoiturage.createdAt ? couvoiturage.createdAt|date('d/m/Y H:i') : '—' }}
              </div>
            </div>
            <div class="col-md-6">
              <div class="text-muted small">Modifié le</div>
              <div class="fw-semibold">
                {{ couvoiturage.updatedAt ? couvoiturage.updatedAt|date('d/m/Y H:i') : '—' }}
              </div>
            </div>

           

            
            
          </div>
        </div>
        
      </div>
      

{% if couvoiturage.passagers is defined %}
              <div class="col-12 my-3">
                <div class="text-muted small mb-1">Passagers participants :</div>
                {% if couvoiturage.passagers|length == 0 %}
                  <div class="text-muted">Aucun passager inscrit.</div>
                {% else %}
                  <ul class="list-unstyled mb-0">
                    {% for p in couvoiturage.passagers %}
                      {#Informations de passager participant#}
                      <div class="card shadow-sm border-0 mb-3" style="max-width: 320px;">
  <div class="row g-0 align-items-center">
    <div class="col-auto d-flex align-items-center justify-content-center rounded mx-1"
         style="width: 40px; height: 40px; background: rgba(0,0,0,.05);">
      <i class="bi bi-person-circle fs-3 text-secondary"></i>
    </div>
    <div class="col">
      <div class="card-body py-2">
        <h6 class="card-title mb-1">{{ p.prenom }} {{ p.nom }}</h6>
        <p class="card-text small mb-1">
          <i class="bi bi-telephone text-muted"></i>
          <a href="tel:{{ p.telephone }}">{{ p.telephone }}</a>
        </p>
        
      </div>
    </div>
  </div>
</div>

                    {% endfor %}
                  </ul>
                {% endif %}
              </div>
            {% endif %}





    </div>

    {# ===== Colonne droite : actions ===== #}
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <strong>Actions</strong>
        </div>
        <div class="card-body d-grid gap-2">
          <a href="{{ path('app_trouver_un_trajet_page') }}" class="btn btn-outline-secondary">
            <i class="bi bi-search"></i> Chercher un couvoiturage
          </a>
          {% if app.user == couvoiturage.driver %}
        <a href="{{ path('app_couvoiturage_edit', {'id': couvoiturage.id}) }}" class="btn btn-primary text-white">
            <i class="bi bi-pencil"></i> Modifier
        </a>
        {% else %}
        {% set lien = couvoiturage.passagers.contains(app.user) ? 'app_passager_annuler_couvoiturage' : 'app_passager_reservation'  %}

                <form method="post" action="{{ path(lien, {'id': couvoiturage.id}) }}">
        <input type="hidden" name="_token" value="{{ csrf_token('reserver' ~ couvoiturage.id) }}">
        {% set full = couvoiturage.nbPlace == 0 and not couvoiturage.passagers.contains(app.user) ? 'disabled' : ''  %}
        {% set texte = couvoiturage.passagers.contains(app.user) ? 'Annuler ma réservation' : 'Réserver ma place'  %}
        
        <button class="btn btn-outline-primary w-100  {{full}}">
             {{texte}} 
        </button>
        </form>
        {% endif %}

        </div>
      </div>
      <div class="card border-0 shadow-sm mb-4  my-2">


  <div class="card-body">
    <h6 class="text-uppercase text-muted small mb-2">
      <i class="bi bi-info-circle me-1"></i> Rappel des conditions pour ce trajet
    </h6>
    <p >
      Merci de respecter les conditions proposées par le conducteur.
    </p>

{% set yes = ['1', 1, true, 'true', 'on', 'yes'] %}
{% set mapYN = { true:'Autorisée', false:'Interdite' } %}
{% set mapTabac = { 'autoriser':'Autorisé', 'interdire':'Interdit', 'discuter':'À discuter' } %}
{% set mapAnimaux = { 'autoriser':'Autorisés', 'interdire':'Interdits', 'discuter':'À discuter' } %}
{% set mapConv = { 'calme':'Calme', 'normal':'Normal', 'bavard':'Bavard' } %}
{% set mapMusic = { 'basse':'Basse', 'moyenne':'Moyenne', 'haute':'Forte' } %}

{% if preferences is empty %}
  <div class="alert alert-info">Aucune préférence enregistrée.</div>
{% else %}
  <div class="row">
    {% for p in preferences %}
      <div class="col-md-12 col-lg-12">
        <div class="card border-0 shadow-sm h-100">
          

          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-slash-circle text-muted me-2"></i> Tabac</span>
              <span class="badge {{ p.politiqueTabac == 'autoriser' ? 'bg-success' : (p.politiqueTabac == 'interdire' ? 'bg-danger' : 'bg-warning text-dark') }}">
                {{ mapTabac[p.politiqueTabac|lower]|default(p.politiqueTabac) }}
              </span>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-bug text-muted me-2"></i> Animaux</span>
              <span class="badge {{ p.politiqueAnimaux == 'autoriser' ? 'bg-success' : (p.politiqueAnimaux == 'interdire' ? 'bg-danger' : 'bg-warning text-dark') }}">
                {{ mapAnimaux[p.politiqueAnimaux|lower]|default(p.politiqueAnimaux) }}
              </span>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-chat-dots text-muted me-2"></i> Conversation</span>
              <span class="fw-semibold">{{ mapConv[p.niveauConversation|lower]|default(p.niveauConversation) }}</span>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-music-note-beamed text-muted me-2"></i> Musique</span>
              <span class="fw-semibold">{{ mapMusic[p.niveauMusique|lower]|default(p.niveauMusique) }}</span>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-egg-fried text-muted me-2"></i> Nourriture</span>
              {% set food = p.autoriseNourriture ? 'Oui' : 'Non' %}
              {{food}}
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-cup-hot text-muted me-2"></i> Boissons</span>
              {% set drink = p.autoriseBoissons ? 'Oui' : 'Non'  %}
              {{drink}}
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span><i class="bi bi-bag text-muted me-2"></i> Bagages (max)</span>
              <span class="fw-semibold">{{ p.tailleMaxBagages }}</span>
            </li>
          </ul>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

  </div>
</div>

    </div>

  </div>
</div>

{% endblock %}
